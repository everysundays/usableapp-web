---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import WhatWeDo from '../components/WhatWeDo.astro';
import Showcase from '../components/Showcase.astro';
import Pricing from '../components/Pricing.astro';
import Contact from '../components/Contact.astro';
---

<Layout
  title="Usable App Co. - Digital Product Design Consultants"
  description="We help startups and SMEs discover what their business really needs. Find good problems. Make good apps."
>
  <!-- Profile Header -->
  <header class="profile-header">
    <div class="profile-info">
      <div class="logo-circle"></div>
      <div class="profile-text">
        <h1 class="profile-name">Usable App Co.</h1>
        <p class="profile-title">Digital Product Design Consultants</p>
      </div>
    </div>
    <div class="social-icons">
      <a href="#" class="social-icon" aria-label="YouTube">
        <i class="fab fa-youtube"></i>
      </a>
      <a href="#" class="social-icon" aria-label="LinkedIn">
        <i class="fab fa-linkedin-in"></i>
      </a>
      <a href="#" class="social-icon" aria-label="Website">
        <i class="fas fa-globe"></i>
      </a>
      <a href="#" class="social-icon" aria-label="Facebook">
        <i class="fab fa-facebook-f"></i>
      </a>
    </div>
  </header>

  <!-- Horizontal Scrolling Container -->
  <div class="slides-container" id="slidesContainer">
    <div class="slides-wrapper" id="slidesWrapper">
      <section class="slide" data-slide="0">
        <Hero />
      </section>
      <section class="slide" data-slide="1">
        <WhatWeDo />
      </section>
      <section class="slide" data-slide="2">
        <Showcase />
      </section>
      <section class="slide" data-slide="3">
        <Pricing />
      </section>
      <section class="slide" data-slide="4">
        <Contact />
      </section>
    </div>
  </div>

  <!-- Navigation Arrow -->
  <button class="nav-arrow nav-arrow-right" id="navArrow" aria-label="Next slide">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
      <polyline points="9 18 15 12 9 6"/>
    </svg>
  </button>

  <!-- Slide Indicators -->
  <div class="slide-indicators" id="slideIndicators">
    <button class="indicator active" data-slide="0" aria-label="Go to slide 1"></button>
    <button class="indicator" data-slide="1" aria-label="Go to slide 2"></button>
    <button class="indicator" data-slide="2" aria-label="Go to slide 3"></button>
    <button class="indicator" data-slide="3" aria-label="Go to slide 4"></button>
    <button class="indicator" data-slide="4" aria-label="Go to slide 5"></button>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <p>&copy; Usable App Co. {new Date().getFullYear()}</p>
  </footer>
</Layout>

<style>
  :global(body) {
    overflow: hidden;
  }

  .profile-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-lg) var(--space-3xl);
    background-color: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-bottom: 2px solid rgba(255, 107, 157, 0.2);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
  }

  .profile-info {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
  }

  .logo-circle {
    width: 48px;
    height: 48px;
    border: 3px solid var(--color-pink);
    border-radius: 50%;
    background: transparent;
    flex-shrink: 0;
    box-shadow: 0 0 15px rgba(255, 107, 157, 0.4);
    position: relative;
    transition: all 0.3s ease;
  }

  .logo-circle:hover {
    transform: rotate(180deg) scale(1.1);
    box-shadow: 0 0 25px rgba(255, 107, 157, 0.6);
  }

  .logo-circle::before {
    content: '';
    position: absolute;
    inset: -4px;
    border: 2px solid var(--color-orange);
    border-radius: 50%;
    opacity: 0.4;
  }

  .profile-name {
    font-size: var(--text-xl);
    font-weight: 200;
    color: var(--color-text);
    margin: 0;
    line-height: 1.2;
    letter-spacing: -0.02em;
    text-transform: uppercase;
  }

  .profile-title {
    font-size: var(--text-xs);
    color: var(--color-text-light);
    margin: 0;
    line-height: 1.2;
    font-weight: 200;
    letter-spacing: 0.05em;
  }

  .social-icons {
    display: flex;
    gap: var(--space-md);
    align-items: center;
  }

  .social-icon {
    width: 36px;
    height: 36px;
    color: var(--color-text);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    border-radius: 50%;
    position: relative;
  }

  .social-icon::before {
    content: '';
    position: absolute;
    inset: -4px;
    border: 1px solid transparent;
    border-radius: 50%;
    transition: all 0.3s ease;
  }

  .social-icon:hover {
    background: linear-gradient(135deg, var(--color-pink) 0%, var(--color-orange) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    transform: translateY(-4px) scale(1.1);
  }

  .social-icon:hover::before {
    border-color: var(--color-pink);
    opacity: 0.3;
  }

  .slides-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: calc(100vh - 80px);
    overflow-x: auto;
    overflow-y: hidden;
    scroll-behavior: smooth;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    padding-top: 80px;
  }

  .slides-container::-webkit-scrollbar {
    display: none;
  }

  .slides-container {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .slides-wrapper {
    display: flex;
    width: 500vw;
    height: calc(100vh - 80px);
  }

  .slide {
    width: 100vw;
    height: calc(100vh - 80px);
    flex-shrink: 0;
    scroll-snap-align: start;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
  }

  @media (max-width: 768px) {
    .slide {
      padding-top: 80px;
    }
  }

  .nav-arrow {
    position: fixed;
    right: var(--space-3xl);
    top: 50%;
    transform: translateY(-50%);
    z-index: 50;
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--color-pink) 0%, var(--color-orange) 100%);
    border: 3px solid rgba(255, 255, 255, 0.3);
    color: var(--color-white);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0.9;
    box-shadow: 0 8px 24px rgba(255, 107, 157, 0.4);
    position: relative;
  }

  .nav-arrow::before {
    content: '';
    position: absolute;
    inset: -6px;
    border: 2px solid var(--color-pink);
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .nav-arrow:hover {
    opacity: 1;
    transform: translateY(-50%) scale(1.15) rotate(5deg);
    box-shadow: 0 12px 36px rgba(255, 107, 157, 0.5);
  }

  .nav-arrow:hover::before {
    opacity: 0.3;
  }

  .nav-arrow svg {
    width: 32px;
    height: 32px;
  }

  .nav-arrow.hidden {
    display: none;
  }

  .slide-indicators {
    position: fixed;
    bottom: var(--space-xl);
    left: 50%;
    transform: translateX(-50%);
    z-index: 50;
    display: flex;
    gap: var(--space-sm);
  }

  .indicator {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 2px solid var(--color-text);
    background: transparent;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 0;
    position: relative;
  }

  .indicator::before {
    content: '';
    position: absolute;
    inset: -4px;
    border: 1px solid transparent;
    border-radius: 50%;
    transition: all 0.3s ease;
  }

  .indicator:hover {
    transform: scale(1.3);
    border-color: var(--color-pink);
  }

  .indicator.active {
    background: linear-gradient(135deg, var(--color-pink) 0%, var(--color-orange) 100%);
    border-color: var(--color-pink);
    box-shadow: 0 0 12px rgba(255, 107, 157, 0.5);
  }

  .indicator.active::before {
    border-color: var(--color-pink);
    opacity: 0.4;
  }

  .site-footer {
    position: fixed;
    bottom: var(--space-md);
    left: var(--space-2xl);
    z-index: 50;
    color: var(--color-text-light);
    font-size: var(--text-sm);
  }

  .site-footer p {
    margin: 0;
  }

  @media (max-width: 768px) {
    .profile-header {
      padding: var(--space-md) var(--space-lg);
    }

    .profile-picture {
      width: 48px;
      height: 48px;
    }

    .profile-name {
      font-size: var(--text-lg);
    }

    .profile-title {
      font-size: var(--text-xs);
    }

    .social-icon {
      width: 24px;
      height: 24px;
    }

    .nav-arrow {
      width: 48px;
      height: 48px;
      right: var(--space-lg);
    }

    .nav-arrow svg {
      width: 24px;
      height: 24px;
    }

    .site-footer {
      left: var(--space-lg);
      bottom: var(--space-sm);
      font-size: var(--text-xs);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('slidesContainer');
    const wrapper = document.getElementById('slidesWrapper');
    const arrow = document.getElementById('navArrow');
    const indicators = document.querySelectorAll('.indicator');
    const slides = document.querySelectorAll('.slide');
    let currentSlide = 0;
    let isScrolling = false;

    // Update active indicator
    function updateIndicator(index: number) {
      indicators.forEach((ind, i) => {
        ind.classList.toggle('active', i === index);
      });
    }

    // Go to slide
    function goToSlide(index: number) {
      if (index < 0 || index >= slides.length) return;
      currentSlide = index;
      container.scrollTo({
        left: index * window.innerWidth,
        behavior: 'smooth'
      });
      updateIndicator(index);
      
      // Hide arrow on last slide
      if (index === slides.length - 1) {
        arrow.classList.add('hidden');
      } else {
        arrow.classList.remove('hidden');
      }
    }

    // Next slide
    function nextSlide() {
      if (currentSlide < slides.length - 1) {
        goToSlide(currentSlide + 1);
      }
    }

    // Arrow click
    arrow.addEventListener('click', nextSlide);

    // Indicator click
    indicators.forEach((ind, index) => {
      ind.addEventListener('click', () => goToSlide(index));
    });

    // Swipe detection
    let touchStartX = 0;
    let touchEndX = 0;

    container.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });

    container.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, { passive: true });

    function handleSwipe() {
      const swipeThreshold = 50;
      const diff = touchStartX - touchEndX;

      if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
          // Swipe left - next
          nextSlide();
        } else {
          // Swipe right - previous
          if (currentSlide > 0) {
            goToSlide(currentSlide - 1);
          }
        }
      }
    }

    // Scroll detection for desktop
    container.addEventListener('scroll', () => {
      if (isScrolling) return;
      
      const scrollLeft = container.scrollLeft;
      const slideWidth = window.innerWidth;
      const newSlide = Math.round(scrollLeft / slideWidth);
      
      if (newSlide !== currentSlide) {
        currentSlide = newSlide;
        updateIndicator(currentSlide);
        
        if (currentSlide === slides.length - 1) {
          arrow.classList.add('hidden');
        } else {
          arrow.classList.remove('hidden');
        }
      }
    }, { passive: true });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
        nextSlide();
      } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
        if (currentSlide > 0) {
          goToSlide(currentSlide - 1);
        }
      }
    });

    // Initialize
    updateIndicator(0);
  });
</script>
